# 实施计划

- [x] 1. 设置项目结构和核心接口
  - 创建 services 目录和核心服务接口
  - 创建 hooks 目录和自定义 Hooks
  - 创建 utils 目录和工具函数
  - 定义优惠券数据模型和类型接口
  - _需求: 1.1, 2.1, 3.1, 4.1_

- [x] 2. 实现数据模型和存储服务
  - [x] 2.1 创建优惠券数据模型和类型定义
    - 定义 Coupon、ValidationResult、CouponError 等接口
    - 创建优惠券状态枚举和错误类型
    - _需求: 1.2, 3.2, 4.3_

  - [x] 2.2 实现云端存储服务 (StorageService)
    - 基于AppSdk.appData创建优惠券存储服务
    - 实现优惠券的创建、查询、更新、删除操作
    - 使用优惠券编码作为记录ID进行存储
    - 添加错误处理和数据验证
    - _需求: 1.3, 3.2, 4.4_

  - [x] 2.3 实现优惠券业务服务 (CouponService)
    - 实现6位编码生成算法（确保唯一性）
    - 基于AppSdk.appData实现优惠券CRUD操作
    - 实现优惠券验证和使用状态管理逻辑
    - 添加优惠券编码查询和状态更新功能
    - _需求: 1.2, 3.1, 4.1, 4.2, 4.3_

- [x] 3. 实现图片生成服务
  - [x] 3.1 创建Canvas图片生成和保存服务 (ImageService)
    - 实现Canvas绘制优惠券图片功能
    - 配置优惠券图片样式（尺寸、颜色、字体）
    - 集成AppSdk.fileSystem.saveImageToAlbum保存图片到相册
    - 添加保存成功/失败的用户反馈
    - _需求: 2.1, 2.2, 2.3_

- [x] 4. 创建自定义Hooks
  - [x] 4.1 创建优惠券管理Hook (useCouponManager)
    - 封装优惠券创建、查询、使用逻辑
    - 管理优惠券状态和错误处理
    - _需求: 1.1, 3.1, 4.1_

  - [x] 4.2 创建图片生成Hook (useImageGenerator)
    - 封装Canvas图片生成逻辑
    - 管理图片生成状态和下载
    - _需求: 2.1, 2.3_

- [x] 5. 实现Tab布局和主应用结构
  - [x] 5.1 更新主应用组件 (app.jsx)
    - 实现IonTabs布局结构
    - 配置创建优惠券和验券管理两个Tab
    - 使用Ionicons设置Tab图标
    - _需求: 1.1, 3.1_

- [x] 6. 实现创建优惠券Tab组件
  - [x] 6.1 创建优惠券创建组件 (CouponCreator)
    - 使用IonPage和PageHeader组件结构
    - 实现金额输入表单和验证
    - 添加创建优惠券按钮和加载状态
    - _需求: 1.1, 1.2, 1.3_

  - [x] 6.2 实现优惠券显示和图片保存
    - 显示生成的优惠券信息（金额和编码）
    - 集成Canvas图片生成功能
    - 使用AppSdk.fileSystem.saveImageToAlbum保存图片到相册
    - 添加保存成功的Toast提示
    - _需求: 1.4, 2.1, 2.2, 2.3_

- [x] 7. 实现验券管理Tab组件
  - [x] 7.1 创建验券输入组件 (CouponValidator)
    - 使用IonPage和PageHeader组件结构
    - 实现6位编码输入框
    - 添加查询按钮和加载状态
    - _需求: 3.1, 3.2_

  - [x] 7.2 实现验券结果显示
    - 显示优惠券查询结果（金额、状态）
    - 实现验券按钮（仅未使用优惠券显示）
    - 处理优惠券不存在的情况
    - _需求: 3.2, 3.3, 4.4_

  - [x] 7.3 实现二次确认验券功能
    - 创建确认对话框组件 (ConfirmationDialog)
    - 实现验券确认逻辑
    - 更新优惠券使用状态
    - 显示验券成功提示
    - _需求: 4.1, 4.2, 4.3, 4.5_

- [x] 8. 实现样式和用户体验优化
  - [x] 8.1 创建CSS Modules样式文件
    - 为各组件创建模块化样式
    - 实现响应式移动端布局
    - 添加加载状态和错误提示样式
    - _需求: 所有需求的用户体验_

  - [x] 8.2 添加错误处理和用户反馈
    - 实现全局错误处理
    - 添加Toast提示消息
    - 优化加载状态显示
    - _需求: 所有需求的错误处理_

- [ ]* 9. 编写单元测试
  - [ ]* 9.1 测试核心服务功能
    - 测试CouponService的编码生成和验证
    - 测试基于AppSdk.appData的StorageService数据操作
    - 测试ImageService的Canvas图片生成和相册保存
    - _需求: 1.2, 2.1, 3.2, 4.1_

  - [ ]* 9.2 测试React组件
    - 测试优惠券创建组件交互
    - 测试验券组件功能
    - 测试Tab导航切换
    - _需求: 1.1, 2.3, 3.1, 4.5_