# 优惠券图片生成更新说明

## 🎨 新设计特点

### 1. 红包风格
- **渐变背景**：从深红色 (#DC2626) 到浅红色 (#F87171)
- **装饰图案**：半透明圆圈装饰，营造红包质感
- **圆角设计**：16px 圆角，更加柔和美观

### 2. 条形码功能
- **位置**：位于优惠券中下部
- **内容**：基于优惠券编码 (code) 生成
- **样式**：黑白条形码，白色背景
- **尺寸**：200x40px，清晰可扫描

### 3. 完整信息展示
优惠券图片包含以下信息（按从上到下顺序）：

1. **公司名称**（可选）- 如果有则显示在顶部
2. **"优惠券"标题** - 标识券类型
3. **金额/折扣** - 大字号显示主要价值
   - 金额券：¥50
   - 折扣券：8.5折
4. **备注信息**（可选）- 使用说明或限制条件
   - 支持自动换行
   - 最多显示 2 行
5. **条形码** - 可扫描的条形码图案
6. **编码文字** - 6位优惠券编码

### 4. 已使用水印
- 对于已使用的优惠券，会添加半透明红色"已使用"水印
- 旋转 -30 度斜向显示
- 防止重复使用

## 📐 技术实现

### 条形码生成算法
```javascript
// 简化版条形码生成
1. 起始标记：1-0-1-0-1
2. 字符编码：每个字符转换为 6 位二进制模式
3. 字符间隔：0
4. 结束标记：1-0-1-0-1
```

### 画布尺寸
- **宽度**：400px
- **高度**：280px（从 200px 增加以容纳更多内容）
- **格式**：PNG，Base64 编码

### 颜色方案
```css
/* 红包渐变 */
gradient.addColorStop(0, '#DC2626');   /* 深红色 */
gradient.addColorStop(0.5, '#EF4444'); /* 红色 */
gradient.addColorStop(1, '#F87171');   /* 浅红色 */

/* 文字颜色 */
textColor: '#FFFFFF'  /* 白色 */

/* 条形码 */
background: '#FFFFFF' /* 白色背景 */
bars: '#000000'       /* 黑色条纹 */
```

## 🎯 使用示例

### 金额券示例
```javascript
const coupon = {
  code: 'ABC123',
  type: 'amount',
  amount: 50,
  companyName: 'XX商城',
  note: '满100元可用',
  isUsed: false
};
```

生成的图片将显示：
```
┌─────────────────────┐
│    XX商城           │
│    优惠券           │
│     ¥50            │
│   满100元可用       │
│   ▌▐▌▐▌▐▌▐▌▐▌      │ (条形码)
│    ABC123          │
└─────────────────────┘
```

### 折扣券示例
```javascript
const coupon = {
  code: 'XYZ789',
  type: 'discount',
  discount: 8.5,
  companyName: 'YY超市',
  note: '全场通用',
  isUsed: false
};
```

生成的图片将显示：
```
┌─────────────────────┐
│    YY超市           │
│    优惠券           │
│    8.5折           │
│    全场通用         │
│   ▌▐▌▐▌▐▌▐▌▐▌      │ (条形码)
│    XYZ789          │
└─────────────────────┘
```

## 🔄 自动适配

### 内容自适应
- **无公司名称**：自动调整布局，节省空间
- **无备注**：跳过备注区域
- **长备注**：自动换行，最多 2 行
- **已使用**：自动添加水印

### 文字处理
- 公司名称：最多 50 字
- 备注信息：最多 200 字，自动换行
- 编码：固定 6 位，等宽字体显示

## 📱 保存功能

生成的图片可以：
1. **保存到相册**：使用 AppSdk.fileSystem.saveImageToAlbum
2. **文件命名**：`coupon_[编码]_[时间戳].png`
3. **格式**：PNG 格式，支持透明度
4. **质量**：高清晰度，适合打印和扫描

## 🎨 视觉效果

### 红包风格特点
- ✅ 喜庆的红色调
- ✅ 渐变效果增加层次感
- ✅ 装饰图案增加质感
- ✅ 圆角设计更加友好
- ✅ 白色文字清晰易读
- ✅ 条形码黑白对比强烈

### 与传统优惠券对比
| 特性 | 旧版 | 新版 |
|------|------|------|
| 颜色 | 蓝紫色 | 红色（红包风格） |
| 条形码 | ❌ | ✅ |
| 公司名称 | ❌ | ✅ |
| 备注信息 | ❌ | ✅ |
| 折扣券 | ❌ | ✅ |
| 装饰图案 | 简单 | 丰富 |

## 🔍 扫描建议

虽然这是简化版条形码，但建议：
1. 主要用于视觉识别
2. 实际验券使用编码文字
3. 如需真实扫描，可集成专业条形码库（如 JsBarcode）

## 📝 后续优化建议

1. **真实条形码**：集成 JsBarcode 或 bwip-js 生成标准条形码
2. **二维码**：添加二维码选项，包含更多信息
3. **自定义主题**：支持用户选择颜色主题
4. **动态尺寸**：根据内容自动调整画布高度
5. **水印定制**：支持自定义水印文字和样式
